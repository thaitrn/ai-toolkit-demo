---
description: 
globs: 
alwaysApply: true
---

# Core Architecture - VTrip Microservices

## ⚠️ CRITICAL: Package Structure (PHẢI TUÂN THỦ CHÍNH XÁC)

Khi tạo code mới, **BẮT BUỘC** phải tạo đúng cấu trúc folder sau:

```
src/main/java/com/vtrip/{service-name}/
├── config/                    # Configuration classes
├── controller/                # REST Controllers
│   └── {Entity}Controller.java
├── dto/
│   ├── request/               # Request DTOs
│   │   ├── Create{Entity}RequestDto.java
│   │   └── Update{Entity}RequestDto.java
│   └── response/              # Response DTOs
│       └── {Entity}ResponseDto.java
├── entity/                    # JPA Entities
│   └── {Entity}.java
├── exception/                 # Custom exceptions
│   └── NotFoundException.java
├── mapper/                    # MapStruct mappers
│   └── {Entity}Mapper.java
├── repository/                # JPA Repositories
│   └── {Entity}Repository.java
└── service/
    ├── {Entity}Service.java   # Interface
    └── impl/
        └── {Entity}ServiceImpl.java  # Implementation
```

## ⛔ KHÔNG ĐƯỢC:
- Đặt tất cả files trong 1 folder duy nhất
- Bỏ qua folder `impl/` cho Service implementation
- Đặt DTO flat, không có subfolder request/response
- Tự đặt tên file khác với pattern trên

## ✅ VÍ DỤ ĐÚNG cho BookingService:

```
src/main/java/com/vtrip/booking/
├── controller/
│   └── BookingController.java
├── dto/
│   ├── request/
│   │   ├── CreateBookingRequestDto.java
│   │   └── UpdateBookingRequestDto.java
│   └── response/
│       └── BookingResponseDto.java
├── entity/
│   └── Booking.java
├── mapper/
│   └── BookingMapper.java
├── repository/
│   └── BookingRepository.java
└── service/
    ├── BookingService.java
    └── impl/
        └── BookingServiceImpl.java
```

## Layered Architecture Rules

1. **Controller Layer**
   - Chỉ xử lý HTTP request/response
   - Validate input bằng `@Valid`
   - KHÔNG chứa business logic

2. **Service Layer**
   - Interface + Implementation pattern (BẮT BUỘC)
   - `@Transactional` cho write operations
   - `@Transactional(readOnly = true)` cho read operations

3. **Repository Layer**
   - Extend `JpaRepository<Entity, Long>`
   - Custom queries dùng `@Query`

## Dependency Injection (BẮT BUỘC)

```java
// ✅ ĐÚNG - Constructor injection với Lombok
@Service
@RequiredArgsConstructor
public class BookingServiceImpl implements BookingService {
    private final BookingRepository bookingRepository;
    private final BookingMapper bookingMapper;
}

// ❌ SAI - Field injection
@Autowired
private BookingRepository bookingRepository;
```

## Naming Conventions

| Type | Pattern | Example |
|------|---------|---------|
| Entity | `{Name}` | `Booking` |
| Controller | `{Name}Controller` | `BookingController` |
| Service Interface | `{Name}Service` | `BookingService` |
| Service Impl | `{Name}ServiceImpl` | `BookingServiceImpl` |
| Repository | `{Name}Repository` | `BookingRepository` |
| Mapper | `{Name}Mapper` | `BookingMapper` |
| Request DTO | `Create{Name}RequestDto` | `CreateBookingRequestDto` |
| Response DTO | `{Name}ResponseDto` | `BookingResponseDto` |
